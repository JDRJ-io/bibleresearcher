# Service‑Worker Validation Guide  (2025‑07)

This checklist verifies that `src/sw.ts`—generated by **vite‑plugin‑pwa**—performs
the required caching and background‑sync duties for the Anointed.io PWA.

## 1  Installation

bash
pnpm build
npx serve -s dist            # or preview deployment

Open Chrome DevTools → Application → Service Workers.

Expect: “Service Worker registered” with scope /.

## 2  Runtime‑Caching Rules
Route	Strategy	Cache name	TTL
/storage/v1/object/public/anointed/*	CacheFirst	bible-files	30 days
precached shell (*.js, *.css, fonts, icons)	Precache	workbox-precache	Forever

### 2‑A Test
Hard‑reload page (disable cache).

In Network tab, filter bible-files → first translation slice shows 200 (network).

Refresh again → same URL shows 200 (cached).

## 3  Background Sync
Turn off network (Offline in DevTools).

Add a bookmark or highlight.

Network tab shows queue-sync PUT request added to Background Sync queue.

Re‑enable network → request flushes automatically.

Expect: Toast “1 queued bookmark synced” via useQueueSync.

## 4  Update Flow
Bump app version (commit).

Deploy preview.

Open prod URL, DevTools → Application → SW shows “Redundant” and new worker installing.

Toast “Update available — Click to refresh” appears via useServiceWorkerStatus.

## 5  Audit Script
validate-architecture.sh runs:

bash
Copy
grep -q "/api/references" dist/service-worker.js && \
  (echo "❌ stray API route in SW"; exit 1)

grep -q "anointed/.*CacheFirst" dist/service-worker.js || \
  (echo "❌ caching rule missing"; exit 1)
Build fails if either condition is unmet.

