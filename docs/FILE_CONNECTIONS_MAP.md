# ðŸ“‚â€¯File Connections & Functions Map
(Anointed.io frontâ€‘end PWAÂ â€” Julyâ€¯2025)

* Legend
â€¢â€¯â†’Â = depends on / importsÂ Â Â â€¢â€¯â¬…Â = consumed byÂ Â Â â€¢â€¯âš™ï¸ŽÂ = core function(s)

## 1â€‚Runtime Data FacadeÂ Â 
client/src/data/BibleDataAPI.tsÂ âš™ï¸Ž
(single gateway to Supabase; holds master LRU verse cache & performs all network fetches)

Method	Purpose	Supabase path
getTranslation(id)	Map<index,text>	translations/${id}.txt
getCrossRefSlice(set,start,end)	byteâ€‘range slice	references/${set}.txt
getCfOffsets(set)	returns offsets JSON	references/${set}_offsets.json
getProphecy(key)	TSV row P/F/V	references/prophecy_rows.txt + prophecy_index.json
getStrongsOffsets()	verse & lemma ranges	references/strongsVerseOffsets.json, strongsIndexOffsets.json
saveNote / saveHighlight / saveBookmark	user mutations	Supabase RPCÂ / INSERT

## 2â€‚Supabase ClientÂ Â 
client/src/lib/supabaseClient.ts
Singleton; used by BibleDataAPI + offline/queueSync.ts.

## 3â€‚State & Stores
File	Type	âš™ï¸Ž Exports	Used by
store/translationSlice.ts	Zustand	main, alternates, columnOrder, anchorIndex, setters	TranslationSelector, ColumnHeaders
hooks/useBibleData.ts	Zustand selector layer	verse text via master cache	VirtualRow, VerseRow
hooks/useOnlineStatus.ts	hook	online/offline boolean	Connectivity badge
hooks/useQueueSync.ts	hook	Dexie â†’ Supabase sync	queueSync.ts
store/useBibleData.ts (legacy name)	alias of above	will be removed once imports migrate	

## 4â€‚Internal Loaders (called only byÂ BibleDataAPI)
File	Role
lib/translationLoader.ts	fetch & parse raw translation text
lib/verseKeysLoader.ts	fetch canonical / chronological key lists
lib/prophecyCache.ts	cache prophecy_rows + index in memory

(These modules never touch React code directly.)

## 5â€‚WorkersÂ Â (registered inÂ lib/workers.ts)
Worker	Purpose	Data in	Data out
translationWorker.js	parse translations/*.txt offâ€‘thread	ArrayBuffer	Map<index,text>
searchWorker.js	fuzzy search index & queries	query string	hits[]
crossReferencesWorker.ts	expand refs via offsets	{key,text}	refs[]
workers.ts	registers the above; keep import list in sync		

* No Worker fetches remote data on its own. All content arrives via postMessage from BibleDataAPI.

## 6â€‚Hooks (runtime data access)
Hook	Purpose
useEnsureTranslationLoaded	lazyâ€‘load translation â†’ master cache
useSliceDataLoader	loads cf offsets + prophecy rows for slice
useTranslationMaps	memoised text selector; wraps master cache
useColumnKeys	returns ordered column key array
plus helper hooks: useAnchorSlice, useScroll, useBodyClass, etc.	

## 7â€‚UI Component Tree (runtime)

App.tsx
 â”œâ”€ ThemeProvider
 â”œâ”€ AuthContext
 â””â”€ BiblePage
     â”œâ”€ TopHeader
     â”œâ”€ HamburgerMenu
     â”‚    â””â”€ TranslationSelector
     â””â”€ VirtualBibleTable
          â”œâ”€ ColumnHeaders
          â”œâ”€ VirtualRow
          â”‚    â”œâ”€ VerseRow
          â”‚    â””â”€ ProphecyColumns
          â”œâ”€ CrossRefsColumn   (UI pending data hookup)
          â””â”€ ExpandedVerseOverlay
Additional atoms: components/LoadingWheel.tsx, shadcn/ui primitives in components/ui/*.

## 8â€‚Auth Components
File	Role
components/auth/AuthModals.tsx	magicâ€‘link signâ€‘in / signâ€‘up
components/auth/UserProfile.tsx	avatar dropdown, signâ€‘out
pages/auth/callback.tsx	Supabase OAuth callback route

(Auth wiring in progress.)

## 9â€‚Offline / PWA
File	Role
offline/offlineDB.ts	Dexie tables: bookmarks, highlights, queued_mutations
offline/queueSync.ts	flush Dexie queue when online
sw.ts	Workbox serviceâ€‘worker (CacheFirst 30â€¯days for Bible files)
vite.config.pwa.ts	manifest + precache generation

## 10â€‚Utility / Config
File	Purpose
tailwind.config.ts	theme tokens, purge paths
postcss.config.js	autoprefixer + tailwind
vite.config.ts + bundleSplit.tsÂ / chunkConfig.ts	manualChunks
tsconfig.json	TS paths & ReactÂ 18 setup
components.json	shadcn/ui generator list
drizzle.config.ts + schema.ts	devâ€‘only DB migrations

## 11â€‚Tests & CI
Item	Check
__tests__/anchor.test.ts, hooks/__tests__/useAnchorSlice.test.ts	anchor invariants
__tests__/offline.test.ts	Dexie queue replay
Cypress suites (scroll, translation-switching, prophesy)	e2e UX
.eslintrc.js custom rule	forbid rawÂ fetch
validate-architecture.sh	grep for /api/references
scripts/bundle-check.js	gzipped build â‰¤â€¯2â€¯MB

## 12â€‚Assets / Public
Path	Notes
public/icon-192.svg, icon-512.svg	PWA icons
public/manifest.json	WebÂ App manifest
No Bible data stored locally â€“ all verse files live in Supabase Storage; duplicate public/verseKeys-canonical.txt has been deleted.	

## Legacy / Deleted
All files under server/

Duplicate client/src/lib/bibleDataAPI.ts, bibleDataOptimized.ts

public/verseKeys-canonical.txt local copy

Any unused shared/types/* modules

These are intentionally removed and should not reâ€‘appear in docs or imports.