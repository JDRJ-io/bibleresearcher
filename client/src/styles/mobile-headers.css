/* Mobile Column Header Positioning Fix */

/* Top header heights */
:root {
  --top-header-height-desktop: 64px;
  --top-header-height-mobile: 48px;
  --column-header-height: 48px;
}

/* Mobile-specific header positioning */
@media (max-width: 640px) {
  /* Position column headers below TopHeader, not overlapping */
  .column-headers-container,
  .column-headers-wrapper {
    position: sticky !important;
    top: var(--top-header-height-mobile) !important; /* Stay below TopHeader */
    z-index: 40 !important;
    background: white !important;
    border-bottom: 1px solid #e5e7eb !important;
    min-height: var(--column-header-height) !important;
    height: var(--column-header-height) !important;
    overflow: hidden !important; /* Hide all scrollbars */
  }

  /* Dark mode support */
  .dark .column-headers-container,
  .dark .column-headers-wrapper {
    background: #1f2937 !important;
    border-bottom-color: #374151 !important;
  }

  /* The scroll area - allow both horizontal and vertical scrolling */
  .bible-content-container {
    margin-top: calc(var(--top-header-height-mobile) + var(--column-header-height)) !important;
    height: calc(100vh - var(--top-header-height-mobile) - var(--column-header-height)) !important;
    overflow-y: auto !important;
    overflow-x: auto !important;    /* Allow horizontal scrolling */
    touch-action: auto !important;  /* Allow all touch scrolling directions */
    overscroll-behavior: contain !important; /* Prevent scroll chaining */
  }

  /* Ensure no gap between headers */
  .top-header-mobile {
    height: var(--top-header-height-mobile) !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 50 !important;
    /* Prevent touch scrolling between header and content */
    touch-action: manipulation !important;
    overflow: hidden !important;
  }

  /* Column header cells responsive sizing - inherit universal alignment */
  .column-header-cell {
    flex-shrink: 0 !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-weight: 600 !important;
    height: var(--column-header-height) !important;
    /* box-sizing, padding, margin, border inherited from universal alignment in index.css */
    /* Prevent horizontal overflow on mobile */
    overflow: hidden !important;
    max-width: 100% !important;
  }

  /* Mobile column headers must use adaptive CSS variables for perfect sync */
  .column-header-cell[data-column="reference"] {
    width: calc((var(--adaptive-ref-width) + 4px) * var(--column-width-mult, 1)) !important;  /* Sync with table content + 4px */
    box-sizing: border-box !important;
    padding: 0 !important; /* NO PADDING - match data cell */
    margin: 0 !important; /* NO MARGIN - match data cell */
    border-left: none !important; /* NO EXTRA BORDERS - match data cell */
  }

  /* Main translation mobile sizing */
  .column-header-cell[data-column="main-translation"] {
    width: calc(var(--adaptive-main-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
  }

  /* Cross references mobile sizing */  
  .column-header-cell[data-column="cross-refs"] {
    width: calc(var(--adaptive-cross-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
  }

  /* Prophecy columns mobile sizing */
  .column-header-cell[data-column="prophecy"] {
    width: calc(var(--adaptive-prophecy-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
  }

  /* Notes column mobile sizing */
  .column-header-cell[data-column="notes"] {
    width: calc(var(--adaptive-notes-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
  }

  /* Context column mobile sizing - hidden in mobile portrait */
  .column-header-cell[data-column="context"] {
    width: 0 !important;  /* Hidden in mobile portrait mode */
    min-width: 0 !important;
    max-width: 0 !important;
    display: none !important;  /* Completely hide context columns */
  }

  /* Landscape phone adjustments - use adaptive variables for perfect sync */
  @media (min-width: 667px) and (max-width: 896px) and (orientation: landscape) {
    .column-header-cell[data-column="reference"] {
      width: calc((var(--adaptive-ref-width) + 4px) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
    }

    .column-header-cell[data-column="main"],
    .column-header-cell[data-column="cross-refs"] {
      width: calc(var(--adaptive-main-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
    }
  }

  /* Tablet and larger screens - use adaptive CSS variables for perfect sync */
  @media (min-width: 641px) {
    .column-header-cell[data-column="reference"] {
      width: calc(var(--adaptive-ref-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
    }

    .column-header-cell[data-column="main-translation"] {
      width: calc(var(--adaptive-main-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
    }

    .column-header-cell[data-column="cross-refs"] {
      width: calc(var(--adaptive-cross-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
    }

    /* Prophecy columns sync */
    .column-header-cell[data-column="prophecy"] {
      width: calc(var(--adaptive-prophecy-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
    }

    /* Notes column sync */
    .column-header-cell[data-column="notes"] {
      width: calc(var(--adaptive-notes-width) * var(--column-width-mult, 1)) !important;  /* Sync with table content */
    }

    /* Context column sync - hidden in mobile portrait */
    .column-header-cell[data-column="context"] {
      width: 0 !important;  /* Hidden in mobile portrait mode */
      min-width: 0 !important;
      max-width: 0 !important;
      display: none !important;  /* Completely hide context columns */
    }
  }
}

/* Mobile reference column - match data cell rotation exactly */
/* Only rotate on very narrow screens (mobile portrait), not tablet portrait */
@media (max-width: 640px) {
  .column-header-cell[data-column="reference"] {
    writing-mode: vertical-rl !important;
    transform: rotate(180deg) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 0.65rem !important;
    line-height: 1 !important;
    overflow: hidden !important;
    white-space: nowrap !important;
    /* Width now handled by unified system in index.css */
  }
}

/* Tablet portrait and wider - keep horizontal verse references */
@media (min-width: 641px) {
  .column-header-cell[data-column="reference"] {
    writing-mode: horizontal-tb !important;
    transform: none !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 0.75rem !important;
    line-height: 1.2 !important;
    overflow: hidden !important;
    white-space: nowrap !important;
  }
}

/* Desktop positioning (ensure no conflicts) */
@media (min-width: 641px) {
  .column-headers-container,
  .column-headers-wrapper {
    position: sticky !important;
    top: var(--top-header-height-desktop) !important;
    z-index: 40 !important;
    min-height: var(--column-header-height) !important;
    height: var(--column-header-height) !important;
    overflow: hidden !important; /* Hide all scrollbars */
  }

  .bible-content-container {
    margin-top: var(--top-header-height-desktop) !important;
    height: calc(100vh - var(--top-header-height-desktop)) !important;
  }
}

/* Fix for iOS Safari viewport issues */
@supports (-webkit-touch-callout: none) {
  @media (max-width: 640px) {
    .column-headers-container,
    .column-headers-wrapper {
      /* Use fixed positioning on iOS to avoid viewport unit issues */
      position: fixed !important;
      top: var(--top-header-height-mobile) !important;
      left: 0 !important;
      right: 0 !important;
      overflow: hidden !important; /* Hide all scrollbars */
    }

    .bible-content-container {
      /* Account for fixed headers on iOS */
      padding-top: var(--column-header-height) !important;
      margin-top: var(--top-header-height-mobile) !important;
      height: calc(100vh - var(--top-header-height-mobile)) !important;
    }
  }
}