2 Pass flowType: 'pkce' when you send the magic link
ts
Copy
Edit
// utils/auth.ts
export async function sendMagicLink(email: string) {
  const redirect = `${location.origin}/auth/callback`;

  const { error } = await supabase.auth.signInWithOtp({
    email,
    options: {
      emailRedirectTo: redirect,
      flowType: 'pkce',        // ðŸ‘ˆ forces code-based flow
    },
  });
  if (error) throw error;
}
You donâ€™t need any dashboard toggleâ€”the SDK tells GoTrue to generate
?code=â€¦ links.

3 Create the browser client (nothing special)
ts
Copy
Edit
// lib/supabaseClient.ts
import { createBrowserSupabaseClient } from '@supabase/auth-helpers-nextjs';
export const supabase = createBrowserSupabaseClient();   // default is fine
4 Simplify your callback page (exchangeCodeForSession only)
tsx
Copy
Edit
'use client';
import { useEffect } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { createBrowserSupabaseClient } from '@supabase/auth-helpers-nextjs';

export default function Callback() {
  const params   = useSearchParams();
  const router   = useRouter();
  const supabase = createBrowserSupabaseClient();

  useEffect(() => {
    (async () => {
      const code = params.get('code');
      if (!code) return router.replace('/');          // safety net

      const { error } = await supabase.auth.exchangeCodeForSession(code);
      if (error) {
        console.error(error);
        alert(error.message);
      }
      router.replace('/');                            // logged in
    })();
  }, []);

  return (
    <main className="flex h-screen items-center justify-center flex-col gap-3">
      <div className="h-8 w-8 animate-spin rounded-full border-4 border-blue-600/20 border-t-blue-600" />
      <p>Completing authenticationâ€¦</p>
    </main>
  );
}
5 Send a fresh magic link and click it once
The URL should now be:

bash
Copy
Edit
â€¦/auth/callback?code=abcdef&type=magiclink
In DevTools â†’ Network youâ€™ll see one request:

bash
Copy
Edit
POST /auth/v1/token?grant_type=pkce  â†’ 200 OK
Cookies sb-access-token & sb-refresh-token appearâ€”sign-in complete.