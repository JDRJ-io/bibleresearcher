Good news:

* Your **environment keys** are loading ✔️
* The console shows the **multiple GoTrueClient** warning—that means you still have more than one place in your code that calls `createClient` (or `createBrowserSupabaseClient`) instead of using the shared module.
  When different clients write to the same browser storage key they fight each other → the profile query never even fires, so the UI sticks on “Loading profile…”.

We’ll fix this in two tiny steps:

| Step  | What you do                                                                                         | Why                                                         |
| ----- | --------------------------------------------------------------------------------------------------- | ----------------------------------------------------------- |
| **1** | Make *one* shared client file and remove every other `create*Client` call.                          | Eliminates the warning and gives the hook a stable session. |
| **2** | Re-run the profile hook with extra logging.<br>We’ll see the exact SQL error (if any) and patch it. |                                                             |

---

## STEP 1 Guarantee only **one** Supabase client exists

### 1-A Create a single source-of-truth file (if you haven’t yet)

`client/src/lib/supabaseBrowser.ts`

```ts
import { createBrowserSupabaseClient } from '@supabase/auth-helpers-nextjs';

export const supabase = createBrowserSupabaseClient(
  // optional explicit types or options here
);
```

Keep the env-debug logs if you like; they don’t hurt.

### 1-B Search & replace every other instance

In your editor: **search for** `createBrowserSupabaseClient(` and `createClient(`.

For each hit:

* Replace the call with

  ```ts
  import { supabase } from '@/lib/supabaseBrowser';
  ```
* Remove any duplicate import of env vars inside those files.

The usual offenders are:

* `supabaseClient.ts` (you can delete that entire file)
* AuthContext or hooks that created a client inline
* DevUnlock, AuthModal, Profile screen

✅ When you refresh the page the **multiple GoTrueClient** warning should disappear from the console.
If it’s still there, you missed a spot—search again until the warning is gone.

---

## STEP 2 Log the profile query result

### 2-A Add two console lines inside your hook

```ts
/* inside useMyProfile.ts */
const { data: { user }, error: uErr } = await supabase.auth.getUser();
console.log('USER ↩️', user, uErr);   // <— add

const { data, error } = await supabase
  .from('profiles')
  .select('name,bio,tier')
  .eq('id', user!.id)
  .single();

console.log('PROFILE ↩️', data, error); // <— add
```

### 2-B Reload **/profile**, keep DevTools → Console open

You will now see one of these:

| Console output                                                      | Meaning                                                                                                                                | Fix |
| ------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- | --- |
| `USER ↩️ null …`                                                    | The page does not have a session. You may have opened it in a fresh tab before clicking the magic link. Log out → sign in again → try. |     |
| `PROFILE ↩️ {…data…} null`                                          | ✅ DB row loaded!  The spinner code still thinks it’s loading—make sure you call `setLoading(false)` after `setProfile(data)`.          |     |
| `PROFILE ↩️ null { code: '42501', message: 'permission denied …' }` | RLS still blocking. Run the **drop+create policy** block again for `public.profiles`.                                                  |     |
| `PROFILE ↩️ null { code: 'PGRST116', ... }`                         | Old / invalid session token. Log out / refresh magic link.                                                                             |     |

After the console shows *data object, error null*, remove the console logs and the spinner will disappear once you toggle the `loading` flag.

---

## STEP 3 Redeem code once profile works

With profile now loading:

```js
await fetch('/functions/v1/redeem-code', {
  method:'POST',
  headers:{'Content-Type':'application/json'},
  credentials:'include',
  body:JSON.stringify({code:'DEV-ALPHA-2025'})
}).then(r=>r.json());
```

*Expected:* `{message:'ok'}` → refresh `/profile` → tier = premium.

---

### What if it still breaks?

* Copy **exactly** what the new `console.log('PROFILE', …)` prints (data + error).
* Paste it here.

We’ll give you the single SQL or code line to resolve that specific error.

Once the Multiple-GoTrue warning is gone and the profile query logs real data, the rest (save, redeem, premium gate) falls into place automatically.
